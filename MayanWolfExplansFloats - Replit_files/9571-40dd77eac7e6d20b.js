(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9571],{42429:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(90116),o=t(84252);function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wait:0},t=null,i=null,a=null,s=null;if(r.wait<0)throw new Error("wait must be 0 or more");if(r.maxWait){if(r.maxWait<0)throw new Error("maxWait must be 0 or more");if(r.maxWait<r.wait)throw new Error("maxWait must be higher than wait")}function c(){if(!r.maxWait)return r.wait;if(!a)throw new Error("Expected scheduledAt to be a set when getting wait");var e=Date.now()-a;return Math.min(r.maxWait-e,r.wait)}function u(){i&&clearTimeout(i),i=null,s=null,t=null,a=null}function l(){if(!t||!i)throw new Error("Expected to call debounced function once before flushing");var r=t,o=s;return u(),e.apply(void 0,(0,n.Z)(o)).then((function(e){return r.resolve(e),e})).catch((function(e){throw r.reject(e),e}))}function f(){if(!i||!t)throw new Error("Expected to call debounced function once before cancelling");var e=t;u(),e.reject(new Error("Debounced function cancelled"))}return Object.assign((function(){if(t){if(!i)throw new Error("Did not expect to have deferred and no timeout");clearTimeout(i)}else t=(0,o.Z)(),a=Date.now();for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return s=r,i=window.setTimeout((function(){l()}),c()),t.promise}),{isScheduled:function(){return Boolean(t&&i)},cancel:f,flush:l})}},84252:function(e,r,t){"use strict";function n(){var e,r,t={promise:new Promise((function(t,n){e=t,r=n})),resolve:function(r){t.isFulfilled=!0,e(r)},reject:function(e){t.isFulfilled=!0,r(e)},isFulfilled:!1};return t}t.d(r,{Z:function(){return n}})},63997:function(e,r,t){"use strict";t.d(r,{Q:function(){return n},o:function(){return o}});var n=".",o=".lesson"},68417:function(e,r,t){"use strict";t.d(r,{Z:function(){return ue}});var n=t(59499),o=t(50029),i=t(90116),a=t(87794),s=t.n(a),c=t(82625),u=t(9571),l=t(94690),f=t(90579),p=t(63997),d=t(50055),h=t(92777),v=t(82262),m=t(81531),b=t(63553),y=t(37247),g=t(17187),w=t(34606),k=t(21145),x=t(91296),E=t.n(x),C=t(62660),O=t(19484),S=t(86374),T=t(45742),F=t(17674);function D(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return R(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return R(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function R(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Z={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)}};function j(e,r){for(var t={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=0,o=Object.keys(t);n<o.length;n++){var i=o[n],a=localStorage.getItem(Z[i](e,r));if(a){var s=void 0;try{s=JSON.parse(a)}catch(c){continue}s&&"object"===typeof s&&"number"===typeof s.crc32&&"number"===typeof s.version&&(t[i]=s)}}return t}function I(){var e=localStorage.getItem(Z.replsList()),r=[];if(e){try{r=JSON.parse(e)}catch(t){localStorage.setItem(Z.replsList(),"[]")}Array.isArray(r)||(r=[],localStorage.setItem(Z.replsList(),"[]"))}return r}function P(e){var r=localStorage.getItem(Z.replFiles(e)),t=[];if(r){try{t=JSON.parse(r)}catch(n){localStorage.setItem(Z.replFiles(e),"[]")}Array.isArray(t)||(t=[],localStorage.setItem(Z.replFiles(e),"[]"))}return t}function N(e){var r,t=D(P(e));try{for(t.s();!(r=t.n()).done;){var n=r.value;"string"===typeof n&&_(e,n)}}catch(i){t.e(i)}finally{t.f()}localStorage.removeItem(Z.replFiles(e));var o=I().filter((function(r){return r!==e}));localStorage.setItem(Z.replsList(),JSON.stringify(o))}function _(e,r){localStorage.removeItem(Z.latestOp(e,r)),localStorage.removeItem(Z.latestFlushedOp(e,r)),localStorage.removeItem(Z.latestOwnOp(e,r));var t=P(e).filter((function(e){return e!==r}));localStorage.setItem(Z.replFiles(e),JSON.stringify(t))}function A(e){var r=e.replId,t=e.filePath;!function(e){var r=I();r.includes(e)||(r.length>20?(N(r[0]),r[0]=e):r.push(e),localStorage.setItem(Z.replsList(),JSON.stringify(r)))}(r);var n=P(r);n.includes(t)||(n.length>20?(N(n[0]),n[0]=t):n.push(t),localStorage.setItem(Z.replFiles(r),JSON.stringify(n)))}function L(e){var r=e.filePath,t=e.replId,n=e.opType,o=e.op;localStorage.setItem(Z[n](t,r),JSON.stringify(o))}var U={};function M(e){return B.apply(this,arguments)}function B(){return B=(0,o.Z)(s().mark((function e(r){var t,n,i,a,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.filePath,n=r.replId,i=r.serverVersion,a=r.serverContent,c=r.fetchOps,!U[t+n]){e.next=3;break}return e.abrupt("return");case 3:U[t+n]=!0,u=j(n,t),l=w.str(a)>>>0,Object.keys(u).forEach(function(){var e=(0,o.Z)(s().mark((function e(r){var t,n,o,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u[r]){e.next=3;break}return e.abrupt("return");case 3:if(!(i<t.version)){e.next=6;break}return O.kg.info("ot client dataloss",{opType:r,case:"server_forgot"}),e.abrupt("return");case 6:if(i!==t.version){e.next=9;break}return l!==t.crc32&&O.kg.info("ot client dataloss",{opType:r,case:"crc32_mistmach"}),e.abrupt("return");case 9:return e.prev=9,e.next=12,c(t.version,t.version);case 12:o=e.sent,a=(0,F.Z)(o,1),n=a[0],e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(9),O.kg.info("ot client dataloss",{opType:r,case:"error_fetching_op"}),e.abrupt("return");case 21:if(n){e.next=24;break}return O.kg.info("ot client dataloss",{opType:r,case:"op_not_found"}),e.abrupt("return");case 24:n.crc32!==t.crc32&&O.kg.info("ot client dataloss",{opType:r,case:"crc32_mismatch"});case 25:case"end":return e.stop()}}),e,null,[[9,17]])})));return function(r){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}function z(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function V(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?z(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function q(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return W(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return W(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){throw e})),f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){s=!0,i=e})),f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function W(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function G(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,y.Z)(e);if(r){var o=(0,y.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,b.Z)(this,t)}}var J=function(e){(0,m.Z)(t,e);var r=G(t);function t(e,n){var i;return(0,h.Z)(this,t),(i=r.call(this)).linkedFile=void 0,i.channel=void 0,i.destroy=void 0,i.pending=void 0,i.inflight=void 0,i.inflightOpsPromise=void 0,i.version=void 0,i.serverContent=void 0,i.localContent=void 0,i.pendingCursors=void 0,i.flushedCursorIds=void 0,i.user=void 0,i.debounceSend=void 0,i.debounceCommit=void 0,i.commitPromise=void 0,i.isReconnecting=void 0,i.shouldTrackReconnects=void 0,i.shouldTrackDataLoss=void 0,i.replId=void 0,i.uncommittedOps=void 0,i.hasUncommittedMultiplayerOps=void 0,i.committedVersion=void 0,i.committedContent=void 0,i.bufferedReconnectingOps=void 0,i.didEditOffline=void 0,i.reconnectTrackedData=void 0,i.timeDisconnected=void 0,i.writeOps=function(e){if(!i.channel&&!i.isReconnecting)throw new Error("Trying to send changes before ever coming online");i.isReconnecting&&(i.didEditOffline=!0);var r,t=i.localContent,n=[],o=0,a=q(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,c=null;switch(typeof s){case"number":o+=s;break;case"string":var u=(0,C.strPosToUni)(t,o);c=u>0?[u,s]:[s],o+=s.length;break;case"object":var l=(0,C.strPosToUni)(t,o),f=(0,C.strPosToUni)(t,o+s.d)-l;c=l>0?[l,{d:f}]:[{d:f}];break;default:return void i.emit("error",new Error("OT Error: unknown op type"))}c&&(t=k.type.apply(t,c),n=k.type.compose(n,c))}}catch(p){a.e(p)}finally{a.f()}i.pending=k.type.compose(i.pending,n),i.localContent=t,0!==i.pending.length?i.emit("fileDirty"):i.commitPromise&&i.emit("commitStart"),i.debounceSend()},i.updateCursors=function(e){i.pendingCursors=e,i.debounceSend()},i.isClean=function(){return i.committedVersion===i.version&&0===i.inflight.length&&0===i.pending.length},i.sendOps=function(){if(i.channel&&"open"===i.channel.status&&!i.isReconnecting&&!(i.inflight.length>0)){if(0!==i.pending.length){var e=i.pending.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}));i.inflight=i.pending,i.pending=[],i.inflightOpsPromise=i.channel.request({ot:{spookyVersion:i.version,ops:e}}),i.inflightOpsPromise.then((function(r){r.error&&i.emit("error",new Error("OT Error: error accepting packet"),{originalError:r.error,ops:e})}))}if(0!==i.pendingCursors.length){var r,t=q(i.flushedCursorIds);try{for(t.s();!(r=t.n()).done;){var n=r.value;i.channel.send({otDeleteCursor:{id:n}})}}catch(u){t.e(u)}finally{t.f()}i.flushedCursorIds=[];var o,a=q(i.pendingCursors);try{for(a.s();!(o=a.n()).done;){var s=o.value,c=Number(Math.random().toString().split(".")[1]).toString(36);i.flushedCursorIds.push(c),i.channel.send({otNewCursor:V({id:c,user:i.user},s)})}}catch(u){a.e(u)}finally{a.f()}i.pendingCursors=[]}}},i.handlePacket=function(e,r){var t=e.ops,n=e.version,o=e.crc32,a=r.overrideReconnectingBuffer;if(!i.isReconnecting||a)if(-1!==i.version){if(i.version++,n!==i.version){var s={expectedVersion:i.version,receievedVersion:n,incomingOps:t};return O.kg.error("OT Error: invalid server version",(0,O.P1)({details:s})),void i.emit("error",new Error("OT Error: invalid server version"),s)}var c="";try{c=k.type.apply(i.serverContent,t)}catch(E){return void i.emit("error",new Error("OT Error: unable to apply updated content"),{originalError:E,incomingOps:t})}var u=w.str(c)>>>0;if(u!==o){var l={version:n,server:o,client:u,incomingOps:t};return O.kg.error("OT Error: crc32 mismatch",(0,O.P1)({details:l})),void i.emit("error",new Error("OT Error: crc32 mismatch"),l)}if(i.uncommittedOps.push({version:n,crc32:o,ops:t}),i.shouldTrackDataLoss&&L({replId:i.replId,filePath:i.linkedFile,opType:"latestOp",op:{version:n,crc32:o}}),JSON.stringify(t)===JSON.stringify(i.inflight))return i.shouldTrackDataLoss&&L({replId:i.replId,filePath:i.linkedFile,opType:"latestOwnOp",op:{version:n,crc32:o}}),i.debounceCommit(),i.inflight=[],i.inflightOpsPromise=null,i.serverContent=c,i.debounceSend(),void i.debounceSend.flush();if(i.commitPromise||i.emit("fileDirty"),i.debounceCommit(),i.hasUncommittedMultiplayerOps=!0,i.inflight.length){var f=k.type.transform(i.inflight,t,"right");t=k.type.transform(t,i.inflight,"left"),i.inflight=f}if(i.pending.length){var p=k.type.transform(i.pending,t,"right");t=k.type.transform(t,i.pending,"left"),i.pending=p}i.localContent=k.type.apply(i.localContent,t);var d,h=[],v=0,m=q(t);try{for(m.s();!(d=m.n()).done;){var b=d.value;switch(typeof b){case"number":v+=b;break;case"string":var y=(0,C.uniToStrPos)(i.localContent,v);h=y>0?T.qC(h,[y,b]):T.qC(h,[b]),v+=(0,C.strPosToUni)(b);break;case"object":var g=(0,C.uniToStrPos)(i.localContent,v),x=(0,C.uniToStrPos)(i.localContent,v+b.d)-g;h=g>0?T.qC(h,[g,{d:x}]):T.qC(h,[{d:x}]);break;default:return void i.emit("error",new Error("OT Error: unknown op type"))}}}catch(S){m.e(S)}finally{m.f()}i.serverContent=c,i.emit("op",h)}else i.emit("error",new Error("Got packet while version is still -1, expected version to be set in handleStatus"));else i.bufferedReconnectingOps.push({crc32:o,ops:t,version:n})},i.handleNewCursor=function(e){i.emit("cursor",e)},i.handleDeleteCursor=function(e){var r=e.id;i.emit("removeCursor",r)},i.handleStatus=function(){var e=(0,o.Z)(s().mark((function e(r){var t,n,o,a,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.channel&&"open"===i.channel.status){e.next=2;break}return e.abrupt("return");case 2:if(!r.linkedFile){e.next=25;break}if(null!=r.contents){e.next=6;break}return i.emit("error",new Error("expected status contents,  got null or undefined")),e.abrupt("return");case 6:if(null!=r.cursors){e.next=9;break}return i.emit("error",new Error("expected status cursors, got null or undefined")),e.abrupt("return");case 9:if(null!=r.version){e.next=12;break}return i.emit("error",new Error("expected status version, got null or undefined")),e.abrupt("return");case 12:if(!i.isReconnecting){e.next=15;break}return i.handleReconnect(r.contents,r.version),e.abrupt("return");case 15:return i.shouldTrackDataLoss&&M({serverContent:r.contents,serverVersion:r.version,replId:i.replId,filePath:i.linkedFile,fetchOps:i.fetchOps}),i.serverContent=r.contents,i.localContent=i.serverContent,i.version=r.version,i.emit("firstConnect"),i.emit("op",[i.serverContent]),r.cursors.forEach(i.handleNewCursor),i.emit("fileDirty"),i.debounceCommit(),e.abrupt("return");case 25:return e.next=27,i.channel.request({otLinkFile:{file:{path:i.linkedFile},highConsistency:Boolean(window["flag-ot-high-consitency"])}});case 27:if(!(o=e.sent).channelClosed){e.next=30;break}return e.abrupt("return");case 30:if(!o.error){e.next=33;break}return i.emit("error",new Error("link file error "+o.error)),e.abrupt("return");case 33:if(o.otLinkFileResponse){e.next=36;break}return i.emit("error",new Error("link file error "+JSON.stringify(o.toJSON()))),e.abrupt("return");case 36:if(a=o.otLinkFileResponse.version,u=c.Z.from(null!==(t=null===(n=o.otLinkFileResponse.linkedFile)||void 0===n?void 0:n.content)&&void 0!==t?t:"").toString(),l=[u],!i.isReconnecting){e.next=42;break}return i.handleReconnect(u,a),e.abrupt("return");case 42:i.shouldTrackDataLoss&&M({serverContent:u,serverVersion:a,replId:i.replId,filePath:i.linkedFile,fetchOps:i.fetchOps}),i.serverContent=u,i.localContent=i.serverContent,i.version=a,i.committedVersion=a,i.committedContent=i.serverContent,i.emit("firstConnect"),i.emit("op",l);case 50:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),i.handleReconnect=function(){var e=(0,o.Z)(s().mark((function e(r,t){var n,o,a,c,u,l,f,p,d,h,v,m,b,y,g,w,x,E,C,O,T,F,D,R,Z,j,I,P,N,_,A;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.timeDisconnected){e.next=2;break}throw new Error("wat");case 2:if(n=Date.now()-i.timeDisconnected,o=function(e){i.reconnectTrackedData=V(V({},e),{},{serverVersion:t,ourVersion:i.version,ourCommittedVersion:i.committedVersion,areContentsEqual:i.serverContent===r,areCommittedContentsEqual:i.committedContent===r,didReceiveOpsWhileReconnecting:Boolean(i.bufferedReconnectingOps),didEditOffline:i.didEditOffline,hasPendingOps:Boolean(i.pending.length),disconnectDuration:n}),i.shouldTrackReconnects&&(0,S.track)(S.events.FILE_RECONNECTED_STATUS2,i.reconnectTrackedData)},a=function(){i.isReconnecting=!1,i.bufferedReconnectingOps=[],i.didEditOffline=!1,i.timeDisconnected=null,i.debounceSend(),i.debounceCommit(),i.emit("reconnected")},!i.inflight.length){e.next=23;break}if(t!==i.version||i.serverContent!==r){e.next=13;break}return o({case:"has_inflight_happy_path_ops_unreached",prompted:!1}),i.pending=k.type.compose(i.inflight,i.pending),i.inflight=[],i.inflightOpsPromise=null,a(),e.abrupt("return");case 13:c=!1,u=i.serverContent;try{u=k.type.apply(r,i.inflight)}catch(s){c=!0}if(c||i.version+1!==t||u!==r){e.next=20;break}return o({case:"has_inflight_happy_path_ops_reached",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 20:return o({case:"has_inflight",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 23:if(!i.hasUncommittedMultiplayerOps){e.next=27;break}return o({case:"multiplayer",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 27:if(i.version!==t){e.next=35;break}if(r!==i.serverContent){e.next=32;break}return o({case:"happy_path",prompted:!1}),a(),e.abrupt("return");case 32:return o({case:"same_version_different_content",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 35:if(i.committedVersion!==t){e.next=61;break}l=r,e.prev=37,f=q(i.uncommittedOps);try{for(f.s();!(p=f.n()).done;)d=p.value.ops,l=k.type.apply(l,d)}catch(L){f.e(L)}finally{f.f()}e.next=47;break;case 42:return e.prev=42,e.t0=e.catch(37),o({case:"same_committed_version_unable_to_apply_ops",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 47:if(l!==i.serverContent){e.next=58;break}o({case:"happy_path_uncommitted",prompted:!1}),h=[],v=q(i.uncommittedOps);try{for(v.s();!(m=v.n()).done;)b=m.value.ops,h=k.type.compose(h,b)}catch(L){v.e(L)}finally{v.f()}return i.pending=k.type.compose(h,i.pending),i.uncommittedOps=[],i.version=t,i.serverContent=r,a(),e.abrupt("return");case 58:return o({case:"same_committed_version_different_content_fixed",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 61:if(!(i.version<t)){e.next=85;break}return e.next=64,i.fetchOps(i.version+1,t);case 64:y=e.sent,g=!1,w=i.serverContent;try{x=q(y);try{for(x.s();!(E=x.n()).done;)C=E.value.ops,w=k.type.apply(w,C)}catch(L){x.e(L)}finally{x.f()}}catch(s){g=!0}if(g||w!==r){e.next=76;break}o({case:"happy_path_server_ahead",prompted:!1}),O=q(y);try{for(O.s();!(T=O.n()).done;)F=T.value,i.handlePacket(F,{overrideReconnectingBuffer:!0})}catch(L){O.e(L)}finally{O.f()}D=q(i.bufferedReconnectingOps);try{for(D.s();!(R=D.n()).done;)Z=R.value,i.handlePacket(Z,{overrideReconnectingBuffer:!0})}catch(L){D.e(L)}finally{D.f()}return a(),e.abrupt("return");case 76:return e.next=78,i.fetchOps(i.committedVersion+1,t);case 78:j=e.sent,I=!1,P=i.committedContent;try{N=q(j);try{for(N.s();!(_=N.n()).done;)A=_.value.ops,P=k.type.apply(P,A)}catch(L){N.e(L)}finally{N.f()}}catch(s){I=!0}return I||P!==r||o({case:"happy_path_uncommitted_server_ahead",prompted:!0}),i.emit("promptUserReconnect"),e.abrupt("return");case 85:o({case:"other",prompted:!0}),i.emit("promptUserReconnect");case 87:case"end":return e.stop()}}),e,null,[[37,42]])})));return function(r,t){return e.apply(this,arguments)}}(),i.flush=(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.commitPromise;case 2:return i.debounceCommit(),i.debounceCommit.flush(),e.next=6,i.commitPromise;case 6:case"end":return e.stop()}}),e)}))),i.fetchOps=function(){var e=(0,o.Z)(s().mark((function e(r,t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.channel){e.next=2;break}throw new Error("No cahnnel, cannot fetch");case 2:return e.next=4,i.channel.request({otFetchRequest:{versionFrom:r,versionTo:t}});case 4:if(!(n=e.sent).channelClosed){e.next=7;break}throw new Error("Channel closed while requesting");case 7:if(!n.error){e.next=9;break}throw new Error("Fetch ops returned an error"+n.error);case 9:if(n.otFetchResponse){e.next=11;break}throw new Error("Expected otFetchResponse");case 11:if(n.otFetchResponse.packets){e.next=13;break}throw new Error("Expected otFetchResponse.packets");case 13:return e.abrupt("return",n.otFetchResponse.packets.map((function(e){var r=e.crc32,t=e.ops,n=e.version;if(null==r)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected ops in packet");if(null==n)throw new Error("Expected version in packet");return{crc32:r,version:n,ops:H(t)}})));case 14:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),i.transformSelection=function(){var e=(0,o.Z)(s().mark((function e(r){var t,n,o,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.indexStart,n=r.indexEnd,o=r.versionFrom,a=r.versionTo,i.channel){e.next=3;break}throw new Error("No channel, cannot fetch");case 3:return e.next=5,i.channel.request({otTransformSelectionRequest:{indexStart:t,indexEnd:n,versionFrom:o,versionTo:a}});case 5:if((c=e.sent).otTransformSelectionResponse){e.next=8;break}throw new Error("Expected otTransformSelectionResponse");case 8:return e.abrupt("return",c.otTransformSelectionResponse);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),i.shouldTrackDataLoss=!1,i.replId="",i.linkedFile=e,i.channel=null,i.inflight=[],i.inflightOpsPromise=null,i.uncommittedOps=[],i.hasUncommittedMultiplayerOps=!1,i.committedVersion=-1,i.isReconnecting=!1,i.bufferedReconnectingOps=[],i.didEditOffline=!1,i.pending=[],i.version=-1,i.serverContent="",i.localContent="",i.committedContent="",i.flushedCursorIds=[],i.pendingCursors=[],i.user=null,i.debounceSend=E()((function(){return i.sendOps()}),20,{maxWait:60}),i.debounceCommit=E()((function(){return i.commitToDisk()}),1e3,{maxWait:3e3}),i.commitPromise=null,i.timeDisconnected=null,i.shouldTrackReconnects=!1,i.destroy=n.openChannel({service:"ot",name:"ot:".concat(e)},(function(r){if(!r.error){var t=r.channel,n=r.context;if(i.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,n.currentUser&&n.repl){var o=window.navigator.userAgent.includes("Firefox");i.shouldTrackDataLoss=n.currentUser.flagTrackOtClientDataLoss&&!o,i.replId=n.repl.id,i.shouldTrackDataLoss&&A({replId:i.replId,filePath:e})}return i.channel=t,t.onCommand((function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.ops||null==e.ot.spookyVersion||null==e.ot.crc32)return void i.emit("error",new Error("OT Error: missing data in ot packet"),e.ot||{});if(-1===i.version)return;var r={crc32:e.ot.crc32,ops:H(e.ot.ops),version:e.ot.spookyVersion};return i.handlePacket(r,{overrideReconnectingBuffer:!1});case"otstatus":return i.handleStatus(e.otstatus);case"error":if(e.ref)return;return i.emit("error",new Error("Unknown protocol error OT channel"),{originalError:e.error||"Server error"});case"otNewCursor":return i.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return i.handleDeleteCursor(e.otDeleteCursor)}})),function(){i.channel=null,i.isReconnecting=!0,i.debounceSend.cancel(),i.debounceCommit.cancel(),i.timeDisconnected||(i.timeDisconnected=Date.now())}}})),i}return(0,v.Z)(t,[{key:"commitToDisk",value:function(){var e=(0,o.Z)(s().mark((function e(){var r,t,n,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channel){e.next=2;break}throw new Error("Tryna commit while offline");case 2:if("open"===this.channel.status){e.next=4;break}return e.abrupt("return");case 4:if(!this.isReconnecting){e.next=6;break}throw new Error("Committing while reconnecting");case 6:if(!this.isClean()){e.next=8;break}return e.abrupt("return");case 8:if(!this.commitPromise){e.next=11;break}return this.debounceCommit(),e.abrupt("return");case 11:if(r=function(){},this.commitPromise=new Promise((function(e){return r=e})),!this.inflightOpsPromise){e.next=21;break}return e.next=16,this.inflightOpsPromise;case 16:if(!e.sent.channelClosed){e.next=21;break}return this.commitPromise=null,r(),e.abrupt("return");case 21:if(!(this.pending.length>0)){e.next=36;break}if(this.debounceSend(),this.debounceSend.flush(),this.inflightOpsPromise){e.next=29;break}return this.commitPromise=null,r(),this.emit("error",new Error("expected inflight promise")),e.abrupt("return");case 29:return e.next=31,this.inflightOpsPromise;case 31:if(!e.sent.channelClosed){e.next=36;break}return this.commitPromise=null,r(),e.abrupt("return");case 36:return this.emit("commitStart"),t=this.version,n=this.serverContent,e.next=41,this.channel.request({flush:{}});case 41:if(!(o=e.sent).channelClosed){e.next=46;break}return this.commitPromise=null,r(),e.abrupt("return");case 46:if("ok"===o.body){e.next=51;break}return this.commitPromise=null,r(),this.emit("error",new Error("OT Error: unable to flush"),{originalError:o.error||o.toString()}),e.abrupt("return");case 51:return this.shouldTrackDataLoss&&(i=this.uncommittedOps[this.uncommittedOps.length-1])&&L({replId:this.replId,filePath:this.linkedFile,op:{crc32:i.crc32,version:i.version},opType:"latestFlushedOp"}),this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=n,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,r(),e.abrupt("return",o);case 61:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(g.EventEmitter);function H(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}var $=J,K=t(94907),X=t(79453),Q=t.n(X),Y=t(40802),ee=t(42429),re=t(84252);function te(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function ne(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?te(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):te(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function oe(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return ie(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ie(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function ie(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ae(e){return!!e.includes("no such file")||!!e.includes("file does not exist")}function se(e){return ae(e)?u.Df.NotFound:e.includes("file exist")?u.Df.AlreadyExists:e.includes("not a directory")?u.Df.NotDirectory:void 0}function ce(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return new Promise((function(r,n){setTimeout((function(){e.apply(void 0,t).then(r).catch(n)}),0)}))}function ue(e){var r,t=e.container,n=null,a=null,h=null,v=0,m=new Map,b=new Map,y=new Map;t.openChannel({service:"fsevents"},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");n=t,t.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a;if(D(),m.get(i)||t.type===d.api.File.Type.DIRECTORY)a=u.Tv.Directory;else{var s,c=Array.from(m.keys()).find((function(e){return(0,f.pC)(e,i)})),p=c&&(null===(s=m.get(c))||void 0===s?void 0:s.children.find((function(e){return e.filename===(0,l.UO)(i)})));a=p?p.type:u.Tv.File}switch(o){case d.api.FileEvent.Op.Create:A({eventType:u.kS.Create,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Modify:if(a===u.Tv.Directory)break;A({eventType:u.kS.Modify,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Remove:A({eventType:u.kS.Delete,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Move:if(null==n||null==n.path)throw new Error("Expected dest path");var h=n.path;A({eventType:u.kS.Move,node:{path:i,type:a},to:h})}}}}}));var o=(0,i.Z)(new Set([].concat((0,i.Z)(m.keys()),(0,i.Z)(b.keys()),(0,i.Z)(y.keys()))));return o.length&&t.send({subscribeFile:{files:o.map((function(e){return{path:e}}))}}),function(){n=null}}}));var g=new Promise((function(e){return r=e}));t.openChannel({service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.error,n=e.channel;if(!t){if(!n)throw new Error("Expected channel");return r(n),function(){g=new Promise((function(e){return r=e}))}}}));var k=(0,re.Z)();k.promise.catch((function(e){return e}));var x=(0,ee.Z)((0,o.Z)(s().mark((function e(){var r,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.promise;case 2:return r=e.sent,e.next=5,r.request({fsSnapshot:{}});case 5:if(!(t=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",{success:!1,error:"channel closed"});case 8:if(!t.error){e.next=10;break}return e.abrupt("return",{success:!1,error:t.error});case 10:return e.abrupt("return",{success:!0});case 11:case"end":return e.stop()}}),e)}))),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");return k.resolve(t),function(){k.isFulfilled&&(k=(0,re.Z)()).promise.catch((function(e){return e}))}}k.isFulfilled||k.reject(r)}));var E=u.kO.Clean,C=[],F=0;function D(){return R.apply(this,arguments)}function R(){return(R=(0,o.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F++,Z(),e.next=4,z.persist();case 4:F--,Z();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(){return j.apply(this,arguments)}function j(){return(j=(0,o.Z)(s().mark((function e(){var r,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0===F&&0===I.length&&Array.from(b.values()).every((function(e){return e.otClient.isClean()})),t=E===u.kO.Clean,r!==t){e.next=4;break}return e.abrupt("return");case 4:E=r?u.kO.Clean:u.kO.Syncing,C.forEach((function(e){e(E)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=[];function P(e){I.push(e),Z(),e.then((function(){var r=I.indexOf(e);r>-1&&I.splice(r,1),D()}))}function N(e,r){return _.apply(this,arguments)}function _(){return _=(0,o.Z)(s().mark((function e(r,t){var n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=(0,o.Z)(s().mark((function e(){var t,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g;case 2:if("open"===(t=e.sent).status){e.next=5;break}return e.abrupt("return",ce(n));case 5:return e.next=7,t.request(r);case 7:if(!(o=e.sent).channelClosed){e.next=10;break}return e.abrupt("return",ce(n));case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=n(),t.isMutative&&P(i),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function A(e){h=null;var r=e.node.path.includes("/")?(0,l.Il)(e.node.path):p.Q,t=m.get(r),n=(0,l.UO)(e.node.path);if(!n)throw new Error("Expected filename");var o=null;if(e.eventType===u.kS.Move){var a=e.to.includes("/")?(0,l.Il)(e.to):p.Q;o=m.get(a)}if(t||o)switch(e.eventType){case u.kS.Create:if(!t)break;var s,c=[].concat((0,i.Z)(t.children.filter((function(e){return e.filename!==n}))),[{type:e.node.type,filename:n}]),d=oe(t.listeners);try{for(d.s();!(s=d.n()).done;){(0,s.value.onChange)(c)}}catch(H){d.e(H)}finally{d.f()}t.children=c;break;case u.kS.Move:var v=(0,l.UO)(e.to);if(t&&t===o){var g,w=[].concat((0,i.Z)(t.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),k=oe(t.listeners);try{for(k.s();!(g=k.n()).done;){(0,g.value.onChange)(w)}}catch(H){k.e(H)}finally{k.f()}t.children=w;break}if(t){var x,E=t.children.filter((function(e){return e.filename!==n})),C=oe(t.listeners);try{for(C.s();!(x=C.n()).done;){(0,x.value.onChange)(E)}}catch(H){C.e(H)}finally{C.f()}t.children=E}if(o){var O,S=[].concat((0,i.Z)(o.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),T=oe(o.listeners);try{for(T.s();!(O=T.n()).done;){(0,O.value.onChange)(S)}}catch(H){T.e(H)}finally{T.f()}o.children=S}break;case u.kS.Delete:if(!t)break;var F,D=t.children.filter((function(e){return e.filename!==n})),R=oe(t.listeners);try{for(R.s();!(F=R.n()).done;){(0,F.value.onChange)(D)}}catch(H){R.e(H)}finally{R.f()}t.children=D;break;case u.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case u.kS.Move:case u.kS.Delete:for(var Z=0,j=[b.get(e.node.path),y.get(e.node.path),m.get(e.node.path)];Z<j.length;Z++){var I=j[Z];if(I){var P,N=oe(I.listeners);try{for(N.s();!(P=N.n()).done;){var _=P.value,L=_.onMoveOrDelete,U=_.dispose;L&&L(e),U()}}catch(H){N.e(H)}finally{N.f()}}}if(e.node.type===u.Tv.File)break;var M,B=(0,i.Z)(new Set([].concat((0,i.Z)(m.keys()),(0,i.Z)(y.keys()),(0,i.Z)(b.keys())))).map((function(e){var r=b.get(e)||y.get(e)||m.get(e);if(!r)throw new Error("expected node");return r})),V=[],q=oe(B.sort());try{for(q.s();!(M=q.n()).done;){var W=M.value;if((0,f.yr)(e.node.path,W.path)){var G=V.slice(-1)[0];if(!G||!(0,f.yr)(G,W.path)){var J={eventType:u.kS.Delete,node:{path:W.path,type:W.type}};e.eventType===u.kS.Move&&(J=ne(ne({},J),{},{eventType:u.kS.Move,to:(0,f.hk)(e.node.path,e.to,W.path)})),V.push(W.path),A(J)}}}}catch(H){q.e(H)}finally{q.f()}break;case u.kS.Create:case u.kS.Modify:if(!y.has(e.node.path))break;z.readFile(e.node.path).then((function(r){var t=y.get(e.node.path);if(t)if(r.error)A({eventType:u.kS.Delete,node:{path:e.node.path,type:u.Tv.File}});else{var n,o=oe(t.listeners);try{for(o.s();!(n=o.n()).done;){var i=n.value.onChange;i&&i(r.content)}}catch(H){o.e(H)}finally{o.f()}}})).catch((function(e){e.message="File read after modify error: "+e.message,Y.Tb(e)}))}}function L(){return U.apply(this,arguments)}function U(){return(U=(0,o.Z)(s().mark((function e(){var r,n,o,a,c,u,l,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.performance.now(),e.next=3,t.exec.apply(t,["ag","--noaffinity","-g *","--hidden"].concat((0,i.Z)(K.ignoredDirs.map((function(e){return"--ignore=".concat(e)})))));case 3:if(o=e.sent,a=o.output,c=o.error,(0,S.track)(S.events.LIST_FILES_EXECUTED,{duration:window.performance.now()-n,failed:Boolean(c)&&"exit status 1"!==c}),u=null===(r=t.getContext())||void 0===r?void 0:r.repl){e.next=10;break}throw new Error("Expected repl");case 10:if(l=function(e){return!!e&&(!(0,K.isHiddenFile)(e)&&!Q().isLangFileBinary(u.language,e))},c||!a){e.next=14;break}return h={error:null,files:a.split("\n").filter(l)},e.abrupt("return",h);case 14:if(!c||!c.includes("not found")){e.next=22;break}return e.next=17,t.exec("find",".","-type","f","-print0");case 17:if(f=e.sent,(0,S.track)(S.events.AG_NOT_AVAILABLE,{language:u.language}),!f.output){e.next=22;break}return h={error:null,files:f.output.slice(2,-1).split("\0./").filter(l)},e.abrupt("return",h);case 22:return"exit status 1"!==c&&Y.Tb(new Error("Find file command failed with error: ".concat(c))),e.abrupt("return",{error:c,files:null});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=function(){var e=(0,o.Z)(s().mark((function e(r,t,n){var i,a,c,l,f,p,d,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){return(c=(0,o.Z)(s().mark((function e(r){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.request(r);case 2:if(!(t=e.sent).channelClosed){e.next=5;break}throw new Error("channelClosed");case 5:if(!t.error){e.next=7;break}throw new Error(t.error);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(e){return c.apply(this,arguments)},e.next=4,g;case 4:return i=e.sent,e.prev=5,e.next=8,a({transferStart:{path:r,size:t.length}});case 8:if(l=e.sent,f=l.transfer){e.next=12;break}throw new Error("Failed to start a transfer (no transfer id)");case 12:p=t.toBuffer(),d=512e3,n(p.length,0),h=0;case 16:if(!(h<Math.ceil(t.length/d))){e.next=23;break}return e.next=19,a({transferChunk:{id:f.id,content:p.subarray(h*d,(h+1)*d)}});case 19:n(p.length,Math.min(p.length,(h+1)*d));case 20:h++,e.next=16;break;case 23:return e.next=25,a({transferComplete:{id:f.id,crc32:w.buf(p)}});case 25:e.next=36;break;case 27:if(e.prev=27,e.t0=e.catch(5),"channelClosed"!==e.t0.message){e.next=31;break}return e.abrupt("return",ce(z.transferFile,r,t,n));case 31:if(!e.t0.message.includes("not a directory")){e.next=33;break}return e.abrupt("return",{error:u.Df.NotDirectory});case 33:if(!e.t0.message.includes("file exists")){e.next=35;break}return e.abrupt("return",{error:u.Df.IsDirectory});case 35:throw e.t0;case 36:return A({eventType:u.kS.Create,node:{path:r,type:u.Tv.File}}),e.abrupt("return",{error:null});case 38:case"end":return e.stop()}}),e,null,[[5,27]])})));return function(r,t,n){return e.apply(this,arguments)}}();function B(e){if(e.startsWith("/home/runner"))throw new Error("watchOtFile requires relative paths");var r=new $(e,t);return r.on("commitComplete",D),r.on("fileDirty",Z),r.on("fileClean",Z),r.on("commitStart",Z),r}var z={getStatus:function(){return E},onStatusChange:function(e){return C.push(e),function(){var r=C.indexOf(e);r>-1&&C.splice(r,1)}},watchDir:function(e,r){var t=!1,o=function r(){t=!0;var n=m.get(e);n&&(n.listeners=n.listeners.filter((function(e){return e.dispose!==r})),0===n.listeners.length&&m.delete(e))};return z.readDir(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError(a),void o()}var s=m.get(e);s||(s={path:e,type:u.Tv.Directory,children:i.children,listeners:[]},m.set(e,s),n&&n.send({subscribeFile:{files:[{path:e}]}})),s.listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.children)}})).catch((function(e){o(),r.onError(e)})),o},writeFile:function(e,r){return(0,o.Z)(s().mark((function t(){var n,o,i,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N({write:{path:e,content:r.toBuffer()}},{isMutative:!0});case 2:if(!(o=t.sent).error){t.next=9;break}if(i=null,o.error.includes("not a directory")?i=u.Df.NotDirectory:o.error.includes("file exists")&&(i=u.Df.IsDirectory),i){t.next=8;break}throw new Error(o.error);case 8:return t.abrupt("return",{error:i});case 9:return a=null===(n=m.get((0,l.Il)(e)))||void 0===n?void 0:n.children.some((function(r){return r.filename===(0,l.UO)(e)})),y.has(e)||b.has(e)||a?A({eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}):A({eventType:u.kS.Create,node:{path:e,type:u.Tv.File}}),t.abrupt("return",{error:null});case 12:case"end":return t.stop()}}),t)})))()},transferFile:function(){var e=arguments;return(0,o.Z)(s().mark((function r(){var t;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return P(t=M.apply(void 0,(0,i.Z)(e))),r.abrupt("return",t);case 3:case"end":return r.stop()}}),r)})))()},readFile:function(e){return(0,o.Z)(s().mark((function r(){var t,n,o;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(t=b.get(e))||!t.otClient.localContent||t.otClient.isReconnecting){r.next=3;break}return r.abrupt("return",{content:c.Z.from(t.otClient.localContent),error:null});case 3:return r.next=5,N({read:{path:e}},{isMutative:!1});case 5:if(!(n=r.sent).error){r.next=12;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("is a directory")&&(o=u.Df.IsDirectory),o){r.next=11;break}throw new Error(n.error);case 11:return r.abrupt("return",{error:o});case 12:if(n.file&&n.file.path&&n.file.content){r.next=14;break}throw new Error("Expected file");case 14:return r.abrupt("return",{content:c.Z.from(n.file.content),error:null});case 15:case"end":return r.stop()}}),r)})))()},createDir:function(e){return(0,o.Z)(s().mark((function r(){var t,n;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({mkdir:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,t.error.includes("not a directory")&&(n=u.Df.NotDirectory),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return A({eventType:u.kS.Create,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},moveDir:function(e,r){return(0,o.Z)(s().mark((function t(){var n,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=se(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return A({eventType:u.kS.Move,node:{path:e,type:u.Tv.Directory},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},moveFile:function(e,r){return(0,o.Z)(s().mark((function t(){var n,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=se(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return A({eventType:u.kS.Move,node:{path:e,type:u.Tv.File},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},copyFile:function(e,r){return(0,o.Z)(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z.readFile(e);case 2:if(!(n=t.sent).error){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",z.writeFile(r,n.content));case 6:case"end":return t.stop()}}),t)})))()},copyDirFromRemote:function(e,r,t){var n=this;return(0,o.Z)(s().mark((function o(){var i,a,c,l,f,p,d,h,v;return s().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.deleteDir(e);case 2:return o.next=4,t.readDir(e);case 4:if(!(i=o.sent).error){o.next=7;break}return o.abrupt("return",i);case 7:return o.next=9,n.readDir(r);case 9:if((a=o.sent).error!==u.Df.NotFound){o.next=15;break}return o.next=13,n.createDir(e);case 13:o.next=17;break;case 15:if(a.error!==u.Df.NotDirectory){o.next=17;break}return o.abrupt("return",a);case 17:c=oe(i.children),o.prev=18,c.s();case 20:if((l=c.n()).done){o.next=44;break}if(f=l.value,p="".concat(e,"/").concat(f.filename),f.type!==u.Tv.File){o.next=36;break}return o.next=26,t.readFile(p);case 26:if(!(d=o.sent).error){o.next=29;break}return o.abrupt("return",d);case 29:return o.next=31,n.writeFile("".concat(r,"/").concat(f.filename),d.content);case 31:if(!(h=o.sent).error){o.next=34;break}return o.abrupt("return",h);case 34:o.next=42;break;case 36:if(f.type!==u.Tv.Directory){o.next=42;break}return o.next=39,n.copyDirFromRemote(p,"".concat(r,"/").concat(f.filename),t);case 39:if(!(v=o.sent).error){o.next=42;break}return o.abrupt("return",v);case 42:o.next=20;break;case 44:o.next=49;break;case 46:o.prev=46,o.t0=o.catch(18),c.e(o.t0);case 49:return o.prev=49,c.f(),o.finish(49);case 52:return o.abrupt("return",{error:null});case 53:case"end":return o.stop()}}),o,null,[[18,46,49,52]])})))()},deleteFile:function(e){return(0,o.Z)(s().mark((function r(){var t,n;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.File}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},deleteDir:function(e){return(0,o.Z)(s().mark((function r(){var t,n;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},readDir:function(e){return(0,o.Z)(s().mark((function r(){var t,n,o,i;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({readdir:{path:e}},{isMutative:!1});case 2:if(!(n=r.sent).error){r.next=9;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("not a directory")&&(o=u.Df.NotDirectory),o){r.next=8;break}throw new Error(n.error);case 8:return r.abrupt("return",{error:o});case 9:if(null!==(t=n.files)&&void 0!==t&&t.files){r.next=11;break}throw new Error("Expected filesChannel");case 11:return i=n.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:e.path,type:e.type===d.api.File.Type.DIRECTORY?u.Tv.Directory:u.Tv.File}})),r.abrupt("return",{children:i,error:null});case 13:case"end":return r.stop()}}),r)})))()},stat:function(e){return(0,o.Z)(s().mark((function r(){var t;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N({stat:{path:e}},{isMutative:!1});case 2:if(!(t=r.sent).error){r.next=5;break}throw new Error(t.error);case 5:if(t.statRes){r.next=7;break}throw new Error("expected stat result");case 7:if(t.statRes.exists){r.next=9;break}return r.abrupt("return",{exists:!1});case 9:if(t.statRes.type!==d.api.File.Type.DIRECTORY){r.next=11;break}return r.abrupt("return",{exists:!0,type:u.Tv.Directory,lastModified:new Date(1e3*t.statRes.modTime)});case 11:return r.abrupt("return",{exists:!0,type:u.Tv.File,lastModified:new Date(1e3*t.statRes.modTime),byteLength:Number(t.statRes.size)});case 12:case"end":return r.stop()}}),r)})))()},watchOtFile:function(e,r,t){var n=this,i=b.get(e);if(i||(i={path:e,type:u.Tv.File,listeners:[],otClient:B(e)},b.set(e,i)),!i)throw new Error("Expected watchedOtFile");t&&(i.otClient.shouldTrackReconnects=!0);var a=!1,l=!1,f=function(){},p=function a(p){if(f(),!i)throw new Error("Expected watchedOtFile");var h=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};i.otClient.on("commitComplete",h);var v=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Dirty)};i.otClient.on("fileDirty",v);var m=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Clean)};i.otClient.on("fileClean",m);var y=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Syncing)};i.otClient.on("commitStart",y);var g=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};i.otClient.on("cursor",g);var w=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};i.otClient.on("removeCursor",w);var k=function(){var r=(0,o.Z)(s().mark((function r(o){var a,u,l,f,p,d,h;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i){r.next=2;break}throw new Error("Expected watchedOtFile");case 2:if((a=i.otClient).destroy(),u=function(){var r=B(e);return t&&(r.shouldTrackReconnects=!0),new Promise((function(e,t){r.once("op",(function(){var t=a.localContent,n=r.localContent,o=(0,T.sQ)(t,n);if(!i)throw new Error("Expected watchedOtFile");i.otClient=r;var s,c=oe(i.listeners);try{for(c.s();!(s=c.n()).done;){(0,s.value.reregister)(o)}}catch(f){c.e(f)}finally{c.f()}e()})),r.once("error",(function(e){return t(e)}))}))},"remote"!==o){r.next=9;break}return r.next=8,u();case 8:return r.abrupt("return");case 9:return r.next=11,n.writeFile(e,c.Z.from(a.localContent));case 11:if(!(l=r.sent).error){r.next=18;break}(f=new Error("Got error while overwriting file during reconnect")).code=l.error,p=oe(i.listeners);try{for(p.s();!(d=p.n()).done;)(h=d.value).onError&&h.onError(f),h.dispose()}catch(f){p.e(f)}finally{p.f()}return r.abrupt("return");case 18:return r.next=20,u();case 20:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),x=function(){var e;return null===(e=r.onReconnectFail)||void 0===e?void 0:e.call(r,k)};i.otClient.on("promptUserReconnect",x),i.listeners[0].reregister===a&&i.otClient.on("promptUserReconnect",(function(){if(b.has(e)){if(!i)throw new Error("Expected watchedOtFile");i.listeners.some((function(e){return e.onReconnectFail}))||k("remote")}}));var E=function(e,t){r.onError&&r.onError(e,t),d()};i.otClient.on("error",E);var C,S=function(e){if(!i)throw new Error("Expected watchedOtFile");i.otClient.writeOps(e);var t,n=oe(i.listeners);try{for(n.s();!(t=n.n()).done;){var o=t.value.onChange;o&&o!==r.onChange&&o({ops:e,changeSource:u.Fl.Local,version:i.otClient.version,latestContent:i.otClient.localContent})}}catch(a){n.e(a)}finally{n.f()}},F=function(e){if(!i)throw new Error("Expected watchedOtFile");i.otClient.updateCursors(e)};(-1!==i.otClient.version&&setTimeout((function(){var e;if(!l){if(!i)throw new Error("Expected watchedOtFile");null===(e=r.onReady)||void 0===e||e.call(r,{initialContent:c.Z.from(i.otClient.localContent),writeOps:S,updateSelections:F,fetchOps:i.otClient.fetchOps,transformSelection:i.otClient.transformSelection,version:i.otClient.version})}})),p)&&(null===(C=r.onChange)||void 0===C||C.call(r,{ops:p,changeSource:u.Fl.Container,version:i.otClient.version,latestContent:i.otClient.localContent}));var D=function(e){var t,n;if(!i)throw new Error("Expected watchedOtFile");if(!l)return l=!0,void(null===(n=r.onReady)||void 0===n||n.call(r,{initialContent:c.Z.from(i.otClient.localContent),writeOps:S,updateSelections:F,fetchOps:i.otClient.fetchOps,transformSelection:i.otClient.transformSelection,version:i.otClient.version}));null===(t=r.onChange)||void 0===t||t.call(r,{ops:e,changeSource:u.Fl.Container,version:i.otClient.version,latestContent:i.otClient.localContent})};i.otClient.on("op",D),f=function(){if(b.get(e)!==i&&(O.kg.error("watchedOtFile in unlisten did not match parent scope"),i=b.get(e)),!i)throw new Error("Expected watchedOtFile");i.otClient.removeListener("commitComplete",h),i.otClient.removeListener("fileDirty",v),i.otClient.removeListener("fileClean",m),i.otClient.removeListener("commitStart",y),i.otClient.removeListener("error",E),i.otClient.removeListener("op",D),i.otClient.removeListener("cursor",g),i.otClient.removeListener("removeCursor",w),i.otClient.removeListener("promptUserReconnect",x)},Z()},d=function r(){if(!a&&b.has(e)){if(a=!0,l=!0,f(),!i)throw new Error("Expected watchedOtFile");i.listeners=i.listeners.filter((function(e){return e.dispose!==r})),0===i.listeners.length&&(i.otClient.destroy(),b.delete(e))}};return i.listeners.push(ne(ne({},r),{},{dispose:d,reregister:p})),p(),d},watchFile:function(e,r){var t=!1,o=function r(){t=!0;var n=y.get(e);n&&(n.listeners=n.listeners.filter((function(e){return e.dispose!==r})),0===n.listeners.length&&y.delete(e))};return z.readFile(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError&&r.onError(a),void o()}var s=y.get(e);if(s||(s={path:e,type:u.Tv.File,listeners:[]},y.set(e,s),n&&n.send({subscribeFile:{files:[{path:e}]}})),!s)throw new Error("Expected watched file");s.listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.content)}})),o},listFiles:function(){return(0,o.Z)(s().mark((function e(){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(h&&window.performance.now()-v<1e4)){e.next=2;break}return e.abrupt("return",h);case 2:return a||(a=L(),v=window.performance.now()),e.next=5,a;case 5:return r=e.sent,a=null,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))()},flush:function(){var e,r=[],t=oe(b.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;r.push(n.otClient.flush())}}catch(o){t.e(o)}finally{t.f()}return Promise.all([].concat(r,I).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var r=x();return e&&e.skipDebounce&&x.flush(),r},getOTVersion:function(e){var r=b.get(e);if(!r)throw new Error("No file with path ".concat(e," found."));return r.otClient.version}};return z}},45742:function(e,r,t){"use strict";t.d(r,{qC:function(){return u},nn:function(){return p},sQ:function(){return d},vs:function(){return h}});var n=t(17674),o=t(37529),i=t.n(o),a=function(e){return e.length>0&&"number"===typeof e[e.length-1]&&e.pop(),e},s=function(e){if(!Array.isArray(e))throw Error("Op must be an array of components");for(var r=null,t=0;t<e.length;t++){var n=e[t];switch(typeof n){case"object":if(!("number"===typeof n.d&&n.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(n.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(n>0))throw Error("Skip components must be >0");if("number"===typeof r)throw Error("Adjacent skip components should be combined")}r=n}if("number"===typeof r)throw Error("Op has a trailing skip")},c=function(e){return"number"===typeof e?e:"string"===typeof e?e.length:e.d};function u(e,r){s(e),s(r);for(var t,n=[],o=l(n),i=f(e)[0],u=0;u<r.length;u++){var p=r[u],d=void 0,h=void 0;switch(typeof p){case"number":for(d=p;d>0;)(h=i(d,"d"))&&o(h),"object"!==typeof h&&(d-=c(h));break;case"string":o(p);break;case"object":for(d=p.d;d>0;)switch(typeof(h=i(d,"d"))){case"number":o({d:h}),d-=h;break;case"string":d-=h.length;break;case"object":h&&o(h)}}}for(;t=i(-1);)o(t);return a(n)}function l(e){return function(r){r&&0!==r.d&&(0===e.length?e.push(r):typeof r===typeof e[e.length-1]?"object"===typeof r?e[e.length-1].d+=r.d:e[e.length-1]+=r:e.push(r))}}function f(e){var r=0,t=0;return[function(n,o){if(r===e.length)return-1===n?null:n;var i,a=e[r];return"number"===typeof a?-1===n||a-t<=n?(i=a-t,++r,t=0,i):(t+=n,n):"string"===typeof a?-1===n||"i"===o||a.length-t<=n?(i=a.slice(t),++r,t=0,i):(i=a.slice(t,t+n),t+=n,i):-1===n||"d"===o||a.d-t<=n?(i={d:a.d-t},++r,t=0,i):(t+=n,{d:n})},function(){return e[r]}]}function p(e,r){if("string"!==typeof e)throw Error("Snapshot should be a string");s(r);for(var t=[],n=0;n<r.length;n++){var o=r[n];switch(typeof o){case"number":if(o>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,o)),e=e.slice(o);break;case"string":t.push(o);break;case"object":e=e.slice(o.d)}}return t.join("")+e}function d(e,r){if(e===r)return[];var t=[],o=function(e){e&&0!==e.d&&(0===t.length?t.push(e):typeof e===typeof t[t.length-1]?"object"===typeof e?t[t.length-1].d+=e.d:t[t.length-1]+=e:t.push(e))};return i()(e,r).forEach((function(e){var r=(0,n.Z)(e,2),t=r[0],a=r[1];switch(t){case i().INSERT:o(a);break;case i().DELETE:o({d:a.length});break;case i().EQUAL:o(a.length)}})),t.length>0&&"number"===typeof t[t.length-1]&&t.pop(),t}function h(e,r,t){if("left"!==t&&"right"!==t)throw Error("side ("+t+") must be 'left' or 'right'");s(e),s(r);for(var o,i=[],u=l(i),p=f(e),d=(0,n.Z)(p,2),h=d[0],v=d[1],m=0;m<r.length;m++){var b=r[m],y=void 0,g=void 0;switch(typeof b){case"number":for(y=b;y>0;)u(g=h(y,"i")),"string"!==typeof g&&(y-=c(g));break;case"string":"left"===t&&"string"===typeof v()&&u(h(-1)),u(b.length);break;case"object":for(y=b.d;y>0;)switch(typeof(g=h(y,"i"))){case"number":y-=g;break;case"string":u(g);break;case"object":y-=g.d}}}for(;o=h(-1);)u(o);return a(i)}},86962:function(e,r,t){"use strict";t.d(r,{Z:function(){return p}});var n=t(50029),o=t(87794),i=t.n(o),a=t(79453),s=t.n(a),c=t(50055),u=t(99455),l=t(74307),f=t(92041);function p(e){var r=e.container,t=e.beforeRun,o=(0,l.Z)(),a=null,p=u.A.OFFLINE,d="none",h=!1,v=Math.random();function m(){var e=function(e){p!==e&&(p=e,o.emit(u.z.STATE_CHANGE,p))};e(a?h?u.A.STOPPING:"none"===d?u.A.IDLE:u.A.RUNNING:u.A.OFFLINE)}function b(){return(b=(0,n.Z)(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE){e.next=2;break}throw new Error("Cannot run while state is not IDLE, got state: "+p);case 2:return r=Math.random(),v=r,d="before-run",m(),e.next=8,t();case 8:if(v===r){e.next=10;break}return e.abrupt("return");case 10:if("none"!==d){e.next=12;break}return e.abrupt("return");case 12:if("server"!==d){e.next=14;break}return e.abrupt("return");case 14:if(a){e.next=16;break}throw new Error("State is RUNNING but shellrunner is null?");case 16:d="optimistic",a.send({runMain:{}});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=(0,n.Z)(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE||p===u.A.RUNNING){e.next=2;break}throw new Error("Can only send input when running or idle");case 2:if(a){e.next=4;break}throw new Error("State is not OFFLINE but shellrunner is null?");case 4:a.send({input:r});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.openChannel({name:"shellrunner",service:"shellrun2",skip:function(e){var r,t=e.repl;return!(0,f.w)()||(r=t.language,!(!0===s().usesInterpreter(r)||!1!==s().usesRunProject(r)))}},(function(e){var r=e.channel;if(!e.error){if(!r)throw new Error("Expected error");return a=r,m(),r.onCommand((function(e){if(null!=e.state){var r=e.state===c.api.State.Stopped;h&&r&&(h=!1),r?"server"===d&&(d="none"):d="server",m()}else null!=e.output&&o.emit(u.z.OUTPUT,e.output)})),function(){d="none",h=!1,a=null,m()}}})),{run:function(){return b.apply(this,arguments)},stopRun:function(){if(p!==u.A.RUNNING)throw new Error("stopRun must be called when running but got ".concat(p));if(!a)throw new Error("State is RUNNING but shellrunner is null?");if("before-run"===d)return d="none",void m();d="none",h=!0,m(),a.send({clear:{}})},sendInput:function(e){return y.apply(this,arguments)},resizeTerminal:function(e){if(!a)throw new Error("resizeTerminal must be called when online");a.send({resizeTerm:e})},onOutput:function(e){return o.on(u.z.OUTPUT,e),function(){o.removeListener(u.z.OUTPUT,e)}},onStateChanged:function(e){return o.on(u.z.STATE_CHANGE,e),function(){o.removeListener(u.z.STATE_CHANGE,e)}},getRunState:function(){return p}}}},82625:function(e,r,t){"use strict";var n=t(92777),o=t(82262),i=t(48764).Buffer,a=function(){function e(r,t){if((0,n.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof r)this.asEncoding[t]=r;else if(void 0===r||null===r)this.asBuffer=i.alloc(0);else if(r instanceof i)this.asBuffer=r;else if("string"===typeof r)this.asEncoding.utf8=r;else if(r instanceof ArrayBuffer)this.asBuffer=i.from(r);else{if(r instanceof e)return r;r instanceof Uint8Array?this.asBuffer=i.from(r):"object"===typeof r&&"object"===typeof r.asEncoding&&null!==r.asEncoding&&(r.asBuffer instanceof i||null===r.asBuffer)&&(this.asBuffer=r.asBuffer||null,"string"===typeof r.asEncoding.base64&&(this.asEncoding={base64:r.asEncoding.base64}),"string"===typeof r.asEncoding.utf8&&(this.asEncoding={utf8:r.asEncoding.utf8}))}}return(0,o.Z)(e,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var r=this.toBuffer(),t=r.toString(e);return this.asEncoding[e]=t,t}},{key:"toJSON",value:function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}}},{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}},{key:"toBuffer",value:function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var r=this.asEncoding[e];if("string"===typeof r){var t=i.from(r,e);return this.asBuffer=t,t}}return this.asBuffer=i.alloc(0),this.asBuffer}}],[{key:"from",value:function(r,t){return new e(r,t)}},{key:"isBuffer",value:function(r){return r instanceof e}}]),e}();r.Z=a},90579:function(e,r,t){"use strict";t.d(r,{GA:function(){return o},yr:function(){return i},pC:function(){return a},vk:function(){return s},hk:function(){return c}});function n(e){return""===e||e.endsWith("/")?e:e+"/"}function o(e,r){return Object.keys(e).filter((function(e){return i(r,e)}))}function i(e,r){return r!==e&&r.startsWith(n(e))}function a(e,r){if(!i(e,r))return!1;var t=n(e),o=r.slice(t.length);return o.endsWith("/")&&(o=o.slice(-1)),!o.includes("/")}function s(e,r,t){var n=o(e,r).map((function(e){return[e,c(r,t,e)]}));return"undefined"!==typeof e[r]&&n.unshift([r,t]),n}function c(e,r,t){var o=n(e);return n(r)+t.slice(o.length)}},96128:function(e,r,t){"use strict";t.d(r,{Rh:function(){return g},Zr:function(){return w},lD:function(){return k}});var n=t(17674),o=t(65988),i=t.n(o),a=t(67294),s=t(66941),c=t(5318),u=t(7903),l=t(34399),f=t(41850),p=t(42463),d=t(99455),h=t(15542),v=t(35944);function m(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return b(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function b(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var y=function(e,r){var t=e.runner,o=e.packager,c=e.languageHeader,u=e.onClear,l=e.enableScreenReaderMode,b=function(e){var r=e.runner,t=e.packager,o=e.languageHeader,i=e.enableScreenReaderMode,s=(0,p.Z)({createXtermProps:{enableScreenReaderMode:i}}),c=(0,n.Z)(s,2),u=c[0],l=c[1],f=a.useState(""),v=(0,n.Z)(f,2),b=v[0],y=v[1];return a.useEffect((function(){if(!u)return r.onOutput((function(e){return y((function(r){return r+e}))}))}),[u,r,y]),a.useEffect((function(){if(!u&&t)return t.onOutput((function(e){return y((function(r){return r+e.replace(/\n/g,"\n\r")}))}))}),[u,t,y]),a.useEffect((function(){if(u&&t)return t.onOutput((function(e){return u.write(e.replace(/\n/g,"\n\r"))}))}),[u,t]),a.useEffect((function(){b&&u&&(u.write(b),y(""))}),[u,b]),a.useEffect((function(){o&&y((function(e){return e+"".concat(o.replace(/\n/g,"\n\r"),"\n\r")}))}),[o,y]),a.useEffect((function(){if(u){var e=function(){r.getRunState()!==d.A.OFFLINE&&r.resizeTerminal(u.getSize())},t=[];t.push(u.onResize(e).dispose);var n=[];t.push(u.onData((function(e){var t=(0,h.I)(e);r.getRunState()!==d.A.OFFLINE?r.sendInput(t):n.push(t)})).dispose),t.push(r.onOutput((function(e){u.write(e)})));var o=!1;return t.push(r.onStateChanged((function(t){if(t!==d.A.OFFLINE){if(o||(e(),o=!0),n.length){var i,a=m(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;r.sendInput(s)}}catch(c){a.e(c)}finally{a.f()}n=[]}}else o=!1}))),r.getRunState()!==d.A.OFFLINE&&(e(),o=!0),function(){t.forEach((function(e){return e()}))}}}),[u,r]),[u,l]}({runner:t,packager:o,languageHeader:c,enableScreenReaderMode:l}),y=(0,n.Z)(b,2),x=y[0],E=y[1],C=a.useState(!1),O=(0,n.Z)(C,2),S=O[0],T=O[1];return a.useImperativeHandle(r,(function(){return{clear:function(){x&&x.clear()}}})),(0,v.BX)("div",{onKeyDown:function(e){"f"===e.key&&(0,s.jh)(e)&&!e.shiftKey&&(T(!0),e.preventDefault())},className:"jsx-650390935 replit-ui-theme-root dark terminal",children:[(0,v.tZ)("div",{className:"jsx-650390935 controls",children:(0,v.BX)(f.Ug,{align:"center",wrap:"nowrap",children:[S&&x?(0,v.tZ)(g,{findPrevious:x.findPrevious,findNext:x.findNext,exit:function(){return T(!1)}}):(0,v.tZ)(k,{onClick:function(){return T(!0)}}),(0,v.tZ)(w,{onClick:function(){x&&(x.clear(),u&&u(),c&&x.write("".concat(c.replace(/\n/g,"\n\r"),"\n\r")),x.focus())}})]})}),(0,v.tZ)("div",{ref:E,className:"jsx-650390935 xterm-container"}),(0,v.tZ)(i(),{id:"650390935",children:[".terminal.jsx-650390935{height:100%;width:100%;position:relative;background-color:var(--background-default);border-radius:var(--border-radius-4);padding-left:var(--space-16);padding-top:var(--space-4);}",".controls.jsx-650390935{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;position:absolute;opacity:0;top:var(--space-8);right:var(--space-8);z-index:100;min-height:30px;}",".terminal.jsx-650390935:focus-within .controls.jsx-650390935{opacity:1;}",".xterm-container.jsx-650390935{height:100%;overflow:auto;}",".xterm-container.jsx-650390935 .xterm{height:100%;}",".xterm-container.jsx-650390935 .xterm-viewport{overflow-y:auto !important;border-radius:var(--border-radius-4);}"]})]})};function g(e){var r=e.findNext,t=e.findPrevious,o=e.exit,s=a.useRef(null),u=a.useState(""),l=(0,n.Z)(u,2),f=l[0],p=l[1];a.useEffect((function(){s.current&&s.current.focus()}),[]);return(0,v.BX)("div",{className:"jsx-2719349621 search",children:[(0,v.tZ)("input",{ref:s,placeholder:"Find",value:f,onChange:function(e){return p(e.target.value)},onKeyDown:function(e){return function(e){"Escape"!==e.key?"Enter"===e.key&&(e.shiftKey?t(f):r(f)):o()}(e)},className:"jsx-2719349621"}),(0,v.tZ)(c.Z,{size:"small",onClick:function(){return r(f)},children:"Next"}),(0,v.tZ)(c.Z,{size:"small",onClick:function(){return t(f)},children:"Previous"}),(0,v.tZ)(c.Z,{size:"small",onClick:o,children:"Exit"}),(0,v.tZ)(i(),{id:"2719349621",children:[".search.jsx-2719349621{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:30px;}","input.jsx-2719349621{padding:4px var(--space-8) var(--space-4);background-color:var(--background-default);color:var(--white);height:24px;width:85px;border:none;border-radius:var(--border-radius-4);box-shadow:none;}","input.jsx-2719349621::-webkit-input-placeholder{color:var(--white);}","input.jsx-2719349621::-moz-placeholder{color:var(--white);}","input.jsx-2719349621:-ms-input-placeholder{color:var(--white);}","input.jsx-2719349621::placeholder{color:var(--white);}","input.jsx-2719349621:focus{outline:none;border:var(--accent-primary-default);}","input.jsx-2719349621,.search button{margin:0 var(--space-4);}"]})]})}r.ZP=a.forwardRef(y);var w=function(e){var r=e.onClick;return(0,v.BX)("button",{"aria-label":"Clear","data-microtip-position":"bottom-left",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,v.tZ)(l.Z,{size:16}),(0,v.tZ)(i(),{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})},k=function(e){var r=e.onClick;return(0,v.BX)("button",{"aria-label":"Search","data-microtip-position":"bottom",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,v.tZ)(u.Z,{size:16}),(0,v.tZ)(i(),{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})}},94907:function(e){e.exports={isHiddenFile:function(e){return/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/.test(e)},ignoredDirs:[".git",".upm",".cache","__pycache__","node_modules"]}}}]);
//# sourceMappingURL=9571-40dd77eac7e6d20b.js.map